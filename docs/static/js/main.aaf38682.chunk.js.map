{"version":3,"sources":["components/content.module.css","components/Errored.tsx","components/FitContent.tsx","components/Content.tsx","App.tsx","constants.ts","services/content.ts","options.ts","index.tsx","components/fit.module.css","components/errored.module.css"],"names":["module","exports","Errored","className","styles","root","indicator","findDistance","from","to","current","getBoundingClientRect","height","FitContent","children","React","useState","fontSize","setFontSize","display","setDisplay","outerRef","useRef","innerRef","incRef","inc","dir","flipCount","useEffect","innerRect","outerRect","distance","targetDistance","console","log","tooMany","size","ref","clsx","outer","hidden","style","inner","paddingTop","src","a","Promise","resolve","reject","image","Image","onload","onerror","e","useImageLoader","loading","setLoading","setImage","loadImage","then","img","ImageElement","timeout","setTimeout","clearTimeout","width","maxWidth","maxHeight","alt","show","Channel","data","Container","href","user_id","slug","title","Block","imageSrc","large","url","undefined","link","class","source","loader","opacity","fill","AttachmentBlock","attachment","attachmentOverlay","pill","extension","TextBlock","content_html","textBlock","dangerouslySetInnerHTML","__html","ChannelOrBlock","base_class","outerContainer","container","innerContainer","Content","past","frame","now","future","getFreshContent","arena","channel","getContent","localStorage","setItem","JSON","stringify","cached","getItem","content","parse","Date","removeItem","updated","error","useArenaStream","failed","setFailed","setData","length","lastSeen","lastIndex","lastItem","id","toString","lastSeenIndex","findIndex","x","nextIndex","nextItem","getNextIndex","catch","err","App","ContentClient","arenaService","this","forceRefresh","contents","window","match","location","search","getChannelFromQueryString","token","ArenaClient","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"uHACAA,EAAOC,QAAU,CAAC,KAAO,sBAAsB,eAAiB,gCAAgC,eAAiB,gCAAgC,UAAY,2BAA2B,OAAS,wBAAwB,MAAQ,uBAAuB,KAAO,sBAAsB,KAAO,sBAAsB,OAAS,wBAAwB,UAAY,2BAA2B,OAAS,wBAAwB,kBAAoB,mCAAmC,KAAO,sBAAsB,MAAQ,uBAAuB,KAAO,sBAAsB,OAAS,0B,0LCE7iB,SAASC,IACd,OACE,yBAAKC,UAAWC,IAAOC,MACrB,yBAAKF,UAAWC,IAAOE,WAAvB,S,2CCFN,SAASC,EACPC,EACAC,GAEA,OAAKA,EAAGC,SAAYF,EAAKE,QAEvBD,EAAGC,QAAQC,wBAAwBC,OACnCJ,EAAKE,QAAQC,wBAAwBC,OAHE,KAOpC,SAASC,EAAT,GAAgE,IAAD,EAAzCC,EAAyC,EAAzCA,SAAyC,EACpCC,IAAMC,SAAS,GADqB,mBAC7DC,EAD6D,KACnDC,EADmD,OAEtCH,IAAMC,UAAS,GAFuB,mBAE7DG,EAF6D,KAEpDC,EAFoD,KAG9DC,EAAWN,IAAMO,OAA8B,MAC/CC,EAAWR,IAAMO,OAA8B,MAC/CE,EAAST,IAAMO,OAAO,CAAEG,IAAK,EAAKC,IAAK,EAAGC,UAAW,IAC3DZ,IAAMa,WAAU,WAAO,IAAD,IACdC,EAAS,UAAGN,EAASb,eAAZ,aAAG,EAAkBC,wBAC9BmB,EAAS,UAAGT,EAASX,eAAZ,aAAG,EAAkBC,wBACpC,GAAKkB,GAAcC,EAAnB,CACA,IAAMC,EAAWxB,EAAagB,EAAUF,GACxC,GAAiB,OAAbU,EAAJ,CACA,IAAMC,EAA6B,GAAXD,EACxB,GAAuB,IAAnBC,EAAJ,CAEAC,QAAQC,IACNF,EACA,KAAOH,EAAUjB,OAAS,KAAOkB,EAAUlB,OAAS,KAEtD,IAAMuB,EAAUX,EAAOd,QAAQiB,UAAY,GACvCK,EAAiB,GACfR,EAAOd,QAAQgB,IAAM,IACvBF,EAAOd,QAAQe,KAAO,IACtBD,EAAOd,QAAQiB,aAEjBH,EAAOd,QAAQgB,KAAO,EACtBR,GAAY,SAACkB,GAAD,OAAUA,EAAOZ,EAAOd,QAAQe,QACnCO,GAAkB,KAAOG,GAC9BX,EAAOd,QAAQgB,IAAM,IACvBF,EAAOd,QAAQe,KAAO,IACtBD,EAAOd,QAAQiB,aAEjBH,EAAOd,QAAQgB,IAAM,EACrBR,GAAY,SAACkB,GAAD,OAAUA,EAAOZ,EAAOd,QAAQe,QAE5CL,GAAW,QAEZ,CAACH,IAEJ,IAAMc,EAAWZ,GAAO,UAAGZ,EAAagB,EAAUF,UAA1B,QAA2C,EACnE,OACE,yBACEgB,IAAKhB,EACLlB,UAAWmC,YAAKlC,IAAOmC,OAAQpB,GAAWf,IAAOoC,QACjDC,MAAO,CAAExB,SAAS,GAAD,OAAKA,EAAL,SAEjB,yBACEoB,IAAKd,EACLpB,UAAWC,IAAOsC,MAClBD,MAAO,CAAEE,WAAYZ,EAAW,IAE/BjB,I,4CC5DT,WAAyB8B,GAAzB,SAAAC,EAAA,+EACS,IAAIC,SAA0B,SAACC,EAASC,GAC7C,IAAMC,EAAQ,IAAIC,MAClBD,EAAME,OAAS,kBAAMJ,EAAQE,IAC7BA,EAAMG,QAAU,SAACC,GAAD,OAAOL,EAAOK,IAC9BJ,EAAML,IAAMA,MALhB,4C,sBASA,SAASU,EAAeV,GAAe,IAAD,EACN7B,IAAMC,UAAS,GADT,mBAC7BuC,EAD6B,KACpBC,EADoB,OAEVzC,IAAMC,SAAkC,MAF9B,mBAE7BiC,EAF6B,KAEtBQ,EAFsB,KAWpC,OARA7B,qBAAU,WACHgB,IACLY,GAAW,G,2CACXE,CAAUd,GAAKe,MAAK,SAACC,GACnBH,EAASG,GACTJ,GAAW,SAEZ,CAACZ,IACG,CACLK,QACAM,WAIJ,SAASM,EAAT,GAA+D,IAAvCZ,EAAsC,EAAtCA,MAAsC,EAC9BlC,IAAMC,UAAS,GADe,mBACrDG,EADqD,KAC5CC,EAD4C,KAM5D,GAJAL,IAAMa,WAAU,WACd,IAAMkC,EAAUC,YAAW,kBAAM3C,GAAW,KAAO,GACnD,OAAO,kBAAM4C,aAAaF,MACzB,IACkB,IAAjBb,EAAMrC,OAAc,OAAO,KAC/B,IACM6B,EADQQ,EAAMgB,MAAQhB,EAAMrC,OAExB,EACJ,CAAEsD,SAAU,OAAQD,MAAOhB,EAAMgB,OACjC,CAAEE,UAAW,OAAQvD,OAAQqC,EAAMrC,QAEzC,OACE,yBACEwD,IAAI,eACJxB,IAAKK,EAAML,IACXH,MAAOA,EACPtC,UAAWmC,YAAKlC,IAAO6C,MAAO9B,GAAWf,IAAOiE,QAKtD,SAASC,EAAT,GAAsD,IAAnCC,EAAkC,EAAlCA,KACjB,OACE,kBAACC,EAAD,CAAWC,KAAI,yBAAoBF,EAAKG,QAAzB,YAAoCH,EAAKI,OACtD,4BAAKJ,EAAKK,OADZ,KAMJ,SAASC,EAAT,GAAkD,IAAD,IAAhCN,EAAgC,EAAhCA,KACTO,EAAQ,OAAGP,QAAH,IAAGA,GAAH,UAAGA,EAAMtB,aAAT,aAAG,EAAa8B,MAAMC,IACpC/C,QAAQC,IAAIqC,GAFmC,MAGpBjB,EAAewB,QAAYG,GAA9ChC,EAHuC,EAGvCA,MAAOM,EAHgC,EAGhCA,QACT2B,EAAsB,SAAfX,EAAKY,MAAL,UAAwBZ,EAAKa,cAA7B,aAAwB,EAAaJ,SAAMC,EACxD,OACE,kBAACT,EAAD,CAAWC,KAAMS,GACdjC,GAAS,kBAACY,EAAD,CAAcZ,MAAOA,IAC/B,yBAAK9C,UAAWC,IAAOiF,OAAQ5C,MAAO,CAAE6C,QAAS/B,EAAU,EAAI,IAC7D,yBAAKpD,UAAWC,IAAOmF,SAM/B,SAASC,EAAT,GAA4D,IAAD,MAAhCjB,EAAgC,EAAhCA,KACnBO,EAAQ,OAAGP,QAAH,IAAGA,GAAH,UAAGA,EAAMtB,aAAT,aAAG,EAAa8B,MAAMC,IACpC/C,QAAQC,IAAIqC,GAF6C,MAG9BjB,EAAewB,QAAYG,GAA9ChC,EAHiD,EAGjDA,MAAOM,EAH0C,EAG1CA,QACf,OACE,kBAACiB,EAAD,CAAWC,KAAI,UAAEF,EAAKkB,kBAAP,aAAE,EAAiBT,KAC/B/B,GAAS,kBAACY,EAAD,CAAcZ,MAAOA,IAC9BA,GACC,yBAAK9C,UAAWC,IAAOiF,OAAQ5C,MAAO,CAAE6C,QAAS/B,EAAU,EAAI,IAC7D,yBAAKpD,UAAWC,IAAOmF,QAG3B,yBAAKpF,UAAWC,IAAOsF,oBACnBzC,GAAS,4BAAKsB,EAAKK,OAErB,wBAAIzE,UAAWC,IAAOuF,MAAtB,UAA6BpB,EAAKkB,kBAAlC,aAA6B,EAAiBG,aAMtD,SAASC,EAAT,GAAsD,IAAjCtB,EAAgC,EAAhCA,KACnB,OAAKA,EAAKuB,aAGR,kBAACtB,EAAD,KACE,kBAAC3D,EAAD,KACE,yBACEV,UAAWC,IAAO2F,UAClBC,wBAAyB,CAAEC,OAAQ1B,EAAKuB,kBAPjB,KAcjC,SAASI,EAAT,GAA4E,IAAlD3B,EAAiD,EAAjDA,KACxB,OAAQA,EAAK4B,YACX,IAAK,QACH,OAAQ5B,EAAKY,OACX,IAAK,aACH,OAAO,kBAACK,EAAD,CAAiBjB,KAAMA,IAChC,IAAK,OACH,OAAO,kBAACsB,EAAD,CAAWtB,KAAMA,IAC1B,QACE,OAAO,kBAACM,EAAD,CAAON,KAAMA,IAE1B,IAAK,UACH,OAAO,kBAACD,EAAD,CAASC,KAAMA,IACxB,QACE,OAAO,MAIb,SAASC,EAAT,GAGgD,IAF9C1D,EAE6C,EAF7CA,SACA2D,EAC6C,EAD7CA,KAEA,OACE,yBAAKtE,UAAWC,IAAOC,MACrB,yBAAKF,UAAWC,IAAOgG,gBACrB,uBAAGjG,UAAWC,IAAOiG,UAAW5B,KAAMA,GACpC,yBAAKtE,UAAWC,IAAOkG,gBAAiBxF,MAc3C,SAASyF,EAAT,GAAyD,IAAtChC,EAAqC,EAArCA,KACxB,OAAKA,EAEH,oCACGA,EAAKiC,KACJ,yBAAKrG,UAAWmC,YAAKlC,IAAOqG,MAAOrG,IAAOoG,OACxC,kBAACN,EAAD,CAAgB3B,KAAMA,EAAKiC,QAE3B,KACJ,yBAAKrG,UAAWC,IAAOqG,OACpBlC,EAAKmC,IAAM,kBAACR,EAAD,CAAgB3B,KAAMA,EAAKmC,MAAU,kBAAClC,EAAD,OAElDD,EAAKoC,OACJ,yBAAKxG,UAAWmC,YAAKlC,IAAOqG,MAAOrG,IAAOuG,SACxC,kBAACT,EAAD,CAAgB3B,KAAMA,EAAKoC,UAE3B,MAfU,kBAACnC,EAAD,M,SChJLoC,E,gFAAf,WACEC,EACAC,GAFF,eAAAjE,EAAA,sEAIqBgE,EAAME,WAAWD,GAJtC,cAIQvC,EAJR,OAKEyC,aAAaC,QChBuB,eDgBSC,KAAKC,UAAU5C,IAL9D,kBAMSA,EAAKA,MANd,4C,kEASA,WACEsC,EACAC,GAFF,mBAAAjE,EAAA,yDAIQuE,EAASJ,aAAaK,QCxBQ,gBDoBtC,yCAKsBT,EAAgBC,EAAOC,IAL7C,mBAOUQ,EAAUJ,KAAKK,MAAMH,GACrBV,EAAMc,KAAKd,MACbY,EAAQR,UAAYA,GACtBE,aAAaS,WC3BU,eD8BvBH,EAAQR,UAAYA,GACpBJ,EAAMY,EAAQI,QC7BkB,MDetC,yCAgBaJ,EAAQ/C,MAhBrB,yDAmBItC,QAAQ0F,MAAR,MAnBJ,iCAqBSf,EAAgBC,EAAOC,IArBhC,2D,sBAgDA,SAASc,EAAef,EAAuBC,GAAkB,IAAD,EAChC/F,IAAMC,UAAS,GADiB,mBACvDuC,EADuD,KAC9CC,EAD8C,OAElCzC,IAAMC,UAAS,GAFmB,mBAEvD6G,EAFuD,KAE/CC,EAF+C,OAGtC/G,IAAMC,SAA4B,MAHI,mBAGvDuD,EAHuD,KAGjDwD,EAHiD,KAiB9D,OAbAhH,IAAMa,WAAU,WACd4B,GAAW,G,6CACXuD,CAAWF,EAAOC,GACfnD,MAAK,SAACY,GACLwD,EAhCR,SAAsBxD,GACpB,IAAKA,GAAwB,IAAhBA,EAAKyD,OAAc,OAAO,KACvC,IAAMC,EAAWjB,aAAaK,QC3CH,aD4C3B,GAAgB,MAAZY,EAAkB,CACpB,IAAMC,EAAY3D,EAAKyD,OAAS,EAC1BG,EAAW5D,EAAK2D,GAEtB,OADAlB,aAAaC,QC/CY,YD+CWkB,EAASC,GAAGC,SAAS,KAClD,CACL7B,KAAM,KACNE,IAAKyB,EACLxB,OAAsB,IAAduB,EAAkB3D,EAAK2D,EAAY,GAAK,MAGpD,IAAMI,EAAgB/D,EAAKgE,WAAU,SAACC,GAAD,OAAOA,EAAEJ,GAAGC,SAAS,MAAQJ,KAC5DQ,EAAYH,EAAgB,EAAIA,EAAgB,EAAI/D,EAAKyD,OAAS,EAClEU,EAAWnE,EAAKkE,GAEtB,OADAzB,aAAaC,QCzDc,YDyDSyB,EAASN,GAAGC,SAAS,KAClD,CACL7B,KAAMiC,IAAclE,EAAKyD,OAAS,EAAIzD,EAAK+D,GAAiB,KAC5D5B,IAAKgC,EACL/B,OAAsB,IAAd8B,EAAkBlE,EAAKkE,EAAY,GAAK,MAYpCE,CAAapE,IACrBf,GAAW,MAEZoF,OAAM,SAACC,GACN5G,QAAQ0F,MAAMkB,GACdrF,GAAW,GACXsE,GAAU,QAEb,CAACjB,EAAOC,IACJ,CACLvD,UACAsE,SACAtD,QAeWuE,MAXf,YAA8E,IAAD,EAClDlB,EADkD,EAA9Df,MAA8D,EAAvDC,SACZe,EADmE,EACnEA,OAAQtD,EAD2D,EAC3DA,KAEhB,OACE,yBAAKpE,UAAU,OACZ0H,GAAU,kBAAC3H,EAAD,OACT2H,GAAU,kBAACtB,EAAD,CAAShC,KAAMA,M,wBE/EpBwE,EAAb,WACE,WAA6BC,GAA6B,yBAA7BA,eAD/B,gGAGmBlC,GAHnB,uFAIuBmC,KAAKD,aAAalC,QAAQA,EAAS,CACpDoC,cAAc,IALpB,cAIU3E,EAJV,yBAOW,CACLuC,UACAvC,KAAMA,EAAK4E,SACXzB,QAASF,KAAKd,QAVpB,8G,MCGS,CACLI,QAJAsC,OAAOpC,aAAaK,QFlBW,YEGnC,WACE,IAAMgC,EAAQD,OAAOE,SAASC,OAAOF,MAAM,kBAC3C,OAAIA,EACKA,EAAM,GAER,KAWLG,IAlBoB,iBAsBpBC,MAHYL,OAAOpC,aAAaK,QFnBH,eEsBbpC,GChBZwE,E,EAAAA,MAAO3C,E,EAAAA,QACTD,EAAQ,IAAIkC,EAAc,IAAIW,cAAY,CAAED,WAElDE,IAASC,OACP,kBAAC,IAAMC,WAAP,KACE,kBAAC,EAAD,CAAKhD,MAAOA,EAAOC,QAASA,KAE9BgD,SAASC,eAAe,U,kBCd1B/J,EAAOC,QAAU,CAAC,MAAQ,mBAAmB,MAAQ,mBAAmB,OAAS,sB,kBCAjFD,EAAOC,QAAU,CAAC,KAAO,sBAAsB,UAAY,8B","file":"static/js/main.aaf38682.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"content_root__2RpRn\",\"outerContainer\":\"content_outerContainer__2BZqH\",\"innerContainer\":\"content_innerContainer__1BxGf\",\"container\":\"content_container__3PSbZ\",\"loader\":\"content_loader__2X1Q3\",\"image\":\"content_image__3UnKa\",\"show\":\"content_show__2_9hf\",\"fill\":\"content_fill__2ah13\",\"fadeIn\":\"content_fadeIn__IQHbI\",\"textBlock\":\"content_textBlock__3EOpF\",\"hidden\":\"content_hidden__36CWT\",\"attachmentOverlay\":\"content_attachmentOverlay__1y7JM\",\"pill\":\"content_pill__1Zwd3\",\"frame\":\"content_frame__15uew\",\"past\":\"content_past__qqLaU\",\"future\":\"content_future__3eWaJ\"};","import React from 'react';\nimport styles from './errored.module.css';\n\nexport function Errored() {\n  return (\n    <div className={styles.root}>\n      <div className={styles.indicator}>snap</div>\n    </div>\n  );\n}\n","import React from 'react';\nimport styles from './fit.module.css';\nimport clsx from 'clsx';\n\nfunction findDistance(\n  from: React.MutableRefObject<HTMLDivElement | null>,\n  to: React.MutableRefObject<HTMLDivElement | null>\n): number | null {\n  if (!to.current || !from.current) return null;\n  return (\n    to.current.getBoundingClientRect().height -\n    from.current.getBoundingClientRect().height\n  );\n}\n\nexport function FitContent({ children }: React.PropsWithChildren<{}>) {\n  const [fontSize, setFontSize] = React.useState(1.0);\n  const [display, setDisplay] = React.useState(false);\n  const outerRef = React.useRef<HTMLDivElement | null>(null);\n  const innerRef = React.useRef<HTMLDivElement | null>(null);\n  const incRef = React.useRef({ inc: 1.0, dir: 0, flipCount: 0 });\n  React.useEffect(() => {\n    const innerRect = innerRef.current?.getBoundingClientRect();\n    const outerRect = outerRef.current?.getBoundingClientRect();\n    if (!innerRect || !outerRect) return;\n    const distance = findDistance(innerRef, outerRef);\n    if (distance === null) return;\n    const targetDistance = -distance + 40;\n    if (targetDistance === 0) return;\n    //innerRect.height - (outerRect.height - 40);\n    console.log(\n      targetDistance,\n      '( ' + innerRect.height + ', ' + outerRect.height + ')'\n    );\n    const tooMany = incRef.current.flipCount > 10;\n    if (targetDistance > 0) {\n      if (incRef.current.dir > 0) {\n        incRef.current.inc *= 0.25;\n        incRef.current.flipCount++;\n      }\n      incRef.current.dir = -1;\n      setFontSize((size) => size - incRef.current.inc);\n    } else if (targetDistance < -40 && !tooMany) {\n      if (incRef.current.dir < 0) {\n        incRef.current.inc *= 0.25;\n        incRef.current.flipCount++;\n      }\n      incRef.current.dir = 1;\n      setFontSize((size) => size + incRef.current.inc);\n    } else {\n      setDisplay(true);\n    }\n  }, [fontSize]);\n\n  const distance = display ? findDistance(innerRef, outerRef) ?? 0 : 0;\n  return (\n    <div\n      ref={outerRef}\n      className={clsx(styles.outer, !display && styles.hidden)}\n      style={{ fontSize: `${fontSize}rem` }}\n    >\n      <div\n        ref={innerRef}\n        className={styles.inner}\n        style={{ paddingTop: distance / 2.0 }}\n      >\n        {children}\n      </div>\n    </div>\n  );\n}\n","import React, { useEffect } from 'react';\nimport styles from './content.module.css';\nimport clsx from 'clsx';\nimport { ChannelApiType, BlockApiType } from 'arena-ts';\nimport { FitContent } from './FitContent';\n\nasync function loadImage(src: string) {\n  return new Promise<HTMLImageElement>((resolve, reject) => {\n    const image = new Image();\n    image.onload = () => resolve(image);\n    image.onerror = (e) => reject(e);\n    image.src = src;\n  });\n}\n\nfunction useImageLoader(src?: string) {\n  const [loading, setLoading] = React.useState(true);\n  const [image, setImage] = React.useState<HTMLImageElement | null>(null);\n  useEffect(() => {\n    if (!src) return;\n    setLoading(true);\n    loadImage(src).then((img) => {\n      setImage(img);\n      setLoading(false);\n    });\n  }, [src]);\n  return {\n    image,\n    loading,\n  };\n}\n\nfunction ImageElement({ image }: { image: HTMLImageElement }) {\n  const [display, setDisplay] = React.useState(false);\n  React.useEffect(() => {\n    const timeout = setTimeout(() => setDisplay(true), 0);\n    return () => clearTimeout(timeout);\n  }, []);\n  if (image.height === 0) return null;\n  const ratio = image.width / image.height;\n  const style =\n    ratio > 1\n      ? { maxWidth: '100%', width: image.width }\n      : { maxHeight: '100%', height: image.height };\n\n  return (\n    <img\n      alt=\"main content\"\n      src={image.src}\n      style={style}\n      className={clsx(styles.image, display && styles.show)}\n    />\n  );\n}\n\nfunction Channel({ data }: { data: ChannelApiType }) {\n  return (\n    <Container href={`https://are.na/${data.user_id}/${data.slug}`}>\n      <h1>{data.title}</h1>;\n    </Container>\n  );\n}\n\nfunction Block({ data }: { data: BlockApiType }) {\n  const imageSrc = data?.image?.large.url;\n  console.log(data);\n  const { image, loading } = useImageLoader(imageSrc || undefined);\n  const link = data.class === 'Link' ? data.source?.url : undefined;\n  return (\n    <Container href={link}>\n      {image && <ImageElement image={image} />}\n      <div className={styles.loader} style={{ opacity: loading ? 1 : 0 }}>\n        <div className={styles.fill} />\n      </div>\n    </Container>\n  );\n}\n\nfunction AttachmentBlock({ data }: { data: BlockApiType }) {\n  const imageSrc = data?.image?.large.url;\n  console.log(data);\n  const { image, loading } = useImageLoader(imageSrc || undefined);\n  return (\n    <Container href={data.attachment?.url}>\n      {image && <ImageElement image={image} />}\n      {image && (\n        <div className={styles.loader} style={{ opacity: loading ? 1 : 0 }}>\n          <div className={styles.fill} />\n        </div>\n      )}\n      <div className={styles.attachmentOverlay}>\n        {!image && <h1>{data.title}</h1>}\n\n        <h1 className={styles.pill}>{data.attachment?.extension}</h1>\n      </div>\n    </Container>\n  );\n}\n\nfunction TextBlock({ data }: { data: BlockApiType }) {\n  if (!data.content_html) return null;\n\n  return (\n    <Container>\n      <FitContent>\n        <div\n          className={styles.textBlock}\n          dangerouslySetInnerHTML={{ __html: data.content_html }}\n        />\n      </FitContent>\n    </Container>\n  );\n}\n\nfunction ChannelOrBlock({ data }: { data: BlockApiType | ChannelApiType }) {\n  switch (data.base_class) {\n    case 'Block':\n      switch (data.class) {\n        case 'Attachment':\n          return <AttachmentBlock data={data} />;\n        case 'Text':\n          return <TextBlock data={data} />;\n        default:\n          return <Block data={data} />;\n      }\n    case 'Channel':\n      return <Channel data={data} />;\n    default:\n      return null;\n  }\n}\n\nfunction Container({\n  children,\n  href,\n}: React.PropsWithChildren<{ href?: string }>) {\n  return (\n    <div className={styles.root}>\n      <div className={styles.outerContainer}>\n        <a className={styles.container} href={href}>\n          <div className={styles.innerContainer}>{children}</div>\n        </a>\n      </div>\n    </div>\n  );\n}\n\ntype BlockOrChannelOrNot = BlockApiType | ChannelApiType | null;\nexport type StreamData = {\n  past: BlockOrChannelOrNot;\n  now: BlockOrChannelOrNot;\n  future: BlockOrChannelOrNot;\n};\n\nexport function Content({ data }: { data: StreamData | null }) {\n  if (!data) return <Container />;\n  return (\n    <>\n      {data.past ? (\n        <div className={clsx(styles.frame, styles.past)}>\n          <ChannelOrBlock data={data.past} />\n        </div>\n      ) : null}\n      <div className={styles.frame}>\n        {data.now ? <ChannelOrBlock data={data.now} /> : <Container />}\n      </div>\n      {data.future ? (\n        <div className={clsx(styles.frame, styles.future)}>\n          <ChannelOrBlock data={data.future} />\n        </div>\n      ) : null}\n    </>\n  );\n}\n","import React from 'react';\nimport { Errored } from './components/Errored';\nimport { Content, StreamData } from './components/Content';\nimport { ContentData, ContentService } from './services/content';\nimport {\n  CHANNEL_DATA_CACHE_KEY,\n  LAST_SEEN_KEY,\n  REFRESH_TIME_BUFFER_MS,\n} from './constants';\nimport { ChannelApiType } from 'arena-ts';\n\nasync function getFreshContent(\n  arena: ContentService,\n  channel: string\n): Promise<ChannelApiType['contents']> {\n  const data = await arena.getContent(channel);\n  localStorage.setItem(CHANNEL_DATA_CACHE_KEY, JSON.stringify(data));\n  return data.data;\n}\n\nasync function getContent(\n  arena: ContentService,\n  channel: string\n): Promise<ChannelApiType['contents']> {\n  const cached = localStorage.getItem(CHANNEL_DATA_CACHE_KEY);\n  if (!cached) return getFreshContent(arena, channel);\n  try {\n    const content = JSON.parse(cached) as ContentData;\n    const now = Date.now();\n    if (content.channel !== channel) {\n      localStorage.removeItem(LAST_SEEN_KEY);\n    }\n    if (\n      content.channel === channel &&\n      now < content.updated + REFRESH_TIME_BUFFER_MS\n    ) {\n      return content.data;\n    }\n  } catch (e) {\n    console.error(e);\n  }\n  return getFreshContent(arena, channel);\n}\n\nfunction getNextIndex(data: ChannelApiType['contents']): StreamData | null {\n  if (!data || data.length === 0) return null;\n  const lastSeen = localStorage.getItem(LAST_SEEN_KEY);\n  if (lastSeen == null) {\n    const lastIndex = data.length - 1;\n    const lastItem = data[lastIndex];\n    localStorage.setItem(LAST_SEEN_KEY, lastItem.id.toString(10));\n    return {\n      past: null,\n      now: lastItem,\n      future: lastIndex !== 0 ? data[lastIndex - 1] : null,\n    };\n  }\n  const lastSeenIndex = data.findIndex((x) => x.id.toString(10) === lastSeen);\n  const nextIndex = lastSeenIndex > 0 ? lastSeenIndex - 1 : data.length - 1;\n  const nextItem = data[nextIndex];\n  localStorage.setItem(LAST_SEEN_KEY, nextItem.id.toString(10));\n  return {\n    past: nextIndex !== data.length - 1 ? data[lastSeenIndex] : null,\n    now: nextItem,\n    future: nextIndex !== 0 ? data[nextIndex - 1] : null,\n  };\n}\n\nfunction useArenaStream(arena: ContentService, channel: string) {\n  const [loading, setLoading] = React.useState(true);\n  const [failed, setFailed] = React.useState(false);\n  const [data, setData] = React.useState<StreamData | null>(null);\n  React.useEffect(() => {\n    setLoading(true);\n    getContent(arena, channel)\n      .then((data) => {\n        setData(getNextIndex(data));\n        setLoading(false);\n      })\n      .catch((err) => {\n        console.error(err);\n        setLoading(false);\n        setFailed(true);\n      });\n  }, [arena, channel]);\n  return {\n    loading,\n    failed,\n    data,\n  };\n}\n\nfunction App({ arena, channel }: { arena: ContentService; channel: string }) {\n  const { failed, data } = useArenaStream(arena, channel);\n\n  return (\n    <div className=\"App\">\n      {failed && <Errored />}\n      {!failed && <Content data={data} />}\n    </div>\n  );\n}\n\nexport default App;\n","export const CHANNEL_DATA_CACHE_KEY = 'channel-info';\nexport const OPTIONS_CHANNEL_KEY = 'channel';\nexport const OPTIONS_TOKEN_KEY = 'token';\nexport const LAST_SEEN_KEY = 'last-seen';\n\nexport const REFRESH_TIME_BUFFER_MS = 1000 * 60 * 20;\n","import { ChannelApiType } from 'arena-ts/dist/arena_api_types';\nimport { ArenaService } from 'arena-ts';\n\nexport type ContentData = {\n  channel: string;\n  data: ChannelApiType['contents'];\n  updated: number;\n};\n\n// export function isBlock(\n//   data: Exclude<ChannelApiType['contents'], null>[0]\n// ): data is BlockApiType & ConnectionApiType {\n//   return data.base_class === 'Block';\n// }\n\nexport interface ContentService {\n  getContent(channel: string): Promise<ContentData>;\n}\n\nexport class ContentClient implements ContentService {\n  constructor(private readonly arenaService: ArenaService) {}\n\n  async getContent(channel: string): Promise<ContentData> {\n    const data = await this.arenaService.channel(channel, {\n      forceRefresh: true,\n    });\n    return {\n      channel,\n      data: data.contents,\n      updated: Date.now(),\n    };\n  }\n}\n","import { OPTIONS_CHANNEL_KEY, OPTIONS_TOKEN_KEY } from './constants';\n\nconst DEFAULT_CHANNEL = 'good-sign-offs';\n\nfunction getChannelFromQueryString() {\n  const match = window.location.search.match(/\\?channel=(.+)/);\n  if (match) {\n    return match[1];\n  }\n  return null;\n}\n\ntype Options = {\n  channel: string;\n  token?: string;\n};\n\nexport function getOptions(): Options {\n  const channel =\n    window.localStorage.getItem(OPTIONS_CHANNEL_KEY) ||\n    getChannelFromQueryString();\n  const token = window.localStorage.getItem(OPTIONS_TOKEN_KEY);\n  return {\n    channel: channel || DEFAULT_CHANNEL,\n    token: token || undefined,\n  };\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport { ArenaClient } from 'arena-ts';\nimport { ContentClient } from './services/content';\nimport { getOptions } from './options';\n\nconst { token, channel } = getOptions();\nconst arena = new ContentClient(new ArenaClient({ token }));\n\nReactDOM.render(\n  <React.StrictMode>\n    <App arena={arena} channel={channel} />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"outer\":\"fit_outer__3XMd4\",\"inner\":\"fit_inner__5fSUe\",\"hidden\":\"fit_hidden__25Hq8\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"errored_root__2mzh4\",\"indicator\":\"errored_indicator__1p0FO\"};"],"sourceRoot":""}